<!-- pu.html -->
<!-- Oluşturulma: 2025-04-19 -->
<!-- Hazırlayan: Kafkas -->
<!-- Açıklama:
     PU ekranı 3 ana panelden oluşur:
     - Sol panel: realImages klasöründeki tüm görselleri lazy loading ile listeler.
     - Orta panel: Seçilen görsele göre benzer sonuçları getirir (model, metrik, topN'e göre).
     - Sağ panel: Cluster temsilcilerini gösterir, detay sayfasına yönlendirme yapılabilir.
     Hover'da metadata + büyük görsel görünür. Cluster'a ait görseller çerçeveyle belirginleşir.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PU Ekranı - Pattern Cluster Görünümü</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.css">
  <style>
    body {
      display: flex;
      font-family: Arial, sans-serif;
      margin: 0;
    }
    .move-button {
  background-color: #4caf50;
  color: white;
  border: none;
  padding: 5px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 13px;
}

.cluster-box {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 150px;
  margin: 10px;
}

.cluster-box img {
  width: 100%;
  border-radius: 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.move-to-cluster-btn {
  margin-top: 8px;
  padding: 6px 8px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 4px;
  font-size: 13px;
  cursor: pointer;
  width: 100%;
  white-space: normal;
  text-align: center;
  word-wrap: break-word;
}

.image-box.clustered {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin: 8px;
}



.move-button:hover {
  background-color: #388e3c;
}
    .panel {
      min-width: 300px;
      flex: 1;
      height: 100vh;
      overflow-y: auto;
      padding: 10px;
      border-right: 1px solid #ccc;
    }
    .panel h2 {
      margin-top: 0;
    }
    .image-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .image-box {
      width: 100px;
      height: 100px;
      position: relative;
      border: 2px solid transparent;
      margin-bottom: 0;
      overflow: hidden;
    }
    .image-box.clustered {
      border-color: #4caf50;
    }
    .image-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 4px;
    }
    /* Tooltip içindeki metinleri daha okunaklı hale getir */
    .tooltip p {
      margin: 5px 0;
      font-size: 13px;
    }
    /* Tooltip içindeki yıldızlar için stil */
    .tooltip .feedback-stars {
      margin-top: 8px;
      padding-top: 5px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: center;
    }
    .tooltip .star {
      font-size: 24px;
      color: #ddd;
      cursor: pointer;
      margin-right: 5px;
      transition: color 0.3s ease;
    }
    .tooltip .star.hover,
    .tooltip .star.active {
      color: #f39c12;
    }

    /* Center panel horizontal yayılma */
    #center-panel {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    #center-results {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      align-content: flex-start;
    }
    #center-results .image-box {
      width: 150px;
      height: 150px;
      position: relative;
      overflow: hidden;
    }
    
    /* Buton stilleri */
    .image-buttons {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: none; /* Butonları gizle */
      justify-content: center;
      gap: 5px;
      padding: 4px 2px;
      background-color: rgba(0, 0, 0, 0.7);
      border-radius: 0 0 4px 4px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }
    .image-box:hover .image-buttons {
      opacity: 1;
    }
    .find-harmonious-btn, .compare-btn {
      display: none; /* Butonları gizle */
      font-size: 11px;
      padding: 4px 8px;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
      box-shadow: 0 1px 3px rgba(0,0,0,0.2);
      transition: all 0.2s ease;
      font-weight: bold;
      text-shadow: 0 1px 1px rgba(0,0,0,0.3);
    }
    .find-harmonious-btn {
      background-color: #3498db;
    }
    .find-harmonious-btn:hover {
      background-color: #2980b9;
      transform: translateY(-1px);
    }
    .compare-btn {
      background-color: #9b59b6;
    }
    .compare-btn:hover {
      background-color: #8e44ad;
      transform: translateY(-1px);
    }
    
    .find-harmonious-btn::before {
      content: "🔍";
      margin-right: 4px;
    }
    .compare-btn::before {
      content: "🔎";
      margin-right: 4px;
    }
    
    /* Center paneldeki tooltips için özel stiller */
    #center-panel .tooltip {
      left: auto;
      right: 110%;
      top: 0;
    }
    
    /* Checkbox stilleri */
    .select-checkbox {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 18px;
      height: 18px;
      z-index: 10;
      cursor: pointer;
    }
    
    /* Seçilmiş görsel stilleri */
    .image-box.selected {
      border: 2px solid #9b59b6; /* Mor seçim çerçevesi */
    }
    
    /* Görsel kutusu üzerindeki yıldızlar için stil */
    .image-box .feedback-stars {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: center;
      padding: 5px 0;
      background-color: rgba(0, 0, 0, 0.6);
      z-index: 5;
      opacity: 0.9;
      transition: opacity 0.3s ease;
    }
    
    .image-box:hover .feedback-stars {
      opacity: 1;
    }
    
    .image-box .star {
      font-size: 18px;
      color: #ddd;
      cursor: pointer;
      margin-right: 5px;
      transition: color 0.3s ease;
    }
    
    .image-box .star.hover,
    .image-box .star.active {
      color: #f39c12;
    }
  </style>
</head>
<body>
  <div class="panel" id="left-panel">
    <h2>🖼️ Sol Panel - Tüm Görseller</h2>
          <label><input type="checkbox" id="center-pre-filter"> 🔍 Önce filtre uygula</label>
      <br><br>
      <label>🌟 Karışım:</label>
      <select id="blend-filter">
        <option value="">Tümü</option>
      </select>
      <br><br>
      <label>✨ Özellik:</label>
      <select id="feature-filter">
        <option value="">Tümü</option>
      </select>
      <br><br>
      <label>🔗 Cluster Durumu:</label>
      <select id="cluster-filter">
        <option value="">Tümü</option>
        <option value="clustered">Yalnızca Cluster'lı</option>
        <option value="unclustered">Yalnızca Cluster'sız</option>
      </select>
      <br><br>
      <div id="karisim-panel">
        <label>⚖️ Karışım Ekle:</label>
        <button onclick="addKarisimFilter()">+ Karışım Ekle</button>
        <div class="karisim-wrapper" style="margin-top: 5px;"></div>
      </div>
    <div class="image-grid" id="image-container">
      <!-- Görseller buraya JS ile yüklenecek -->
    </div>
  </div>

  <div id="center-panel" class="panel">
    <h2>🌟 Orta Panel - Benzer Görsel Sonuçları</h2>
    
    <!-- Arama Parametreleri Kulakçığı -->
    <div class="search-panel-header" style="cursor: pointer; padding: 10px; background-color: #f5f5f5; border: 1px solid #ddd; border-radius: 5px 5px 0 0; margin-bottom: 0; display: flex; justify-content: space-between; align-items: center;">
      <h3 style="margin: 0;">💡 Filtreleme Parametreleri</h3>
      <span id="toggle-search-panel" style="font-size: 20px;">▼</span>
    </div>
    
    <!-- Filtreleme Paneli (başlangıçta gizli) -->
    <div id="search-panel-content" class="search-panel" style="margin-bottom: 15px; border: 1px solid #ddd; border-top: none; padding: 10px; border-radius: 0 0 5px 5px; display: none;">
      
      <div class="filter-section">
        <div class="filter-row" style="display: flex; margin-bottom: 8px; align-items: center;">
          <label style="width: 120px;">🎯 Model:</label>
          <select id="model-selector" style="flex-grow: 1; padding: 5px;">
            <option value="pattern">Desen</option>
            <option value="color">Renk</option>
            <option value="texture">Doku</option>
          </select>
        </div>
        
        <div class="filter-row" style="display: flex; margin-bottom: 8px; align-items: center;">
          <label style="width: 120px;">🧠 Versiyon:</label>
          <select id="version-selector" style="flex-grow: 1; padding: 5px;">
            <option value="v1">v1</option>
          </select>
        </div>
        
        <div class="filter-row" style="display: flex; margin-bottom: 8px; align-items: center;">
          <label style="width: 120px;">📏 Metrik:</label>
          <select id="metric-selector" style="flex-grow: 1; padding: 5px;">
            <option value="cosine">Cosine</option>
            <option value="euclidean">Euclidean</option>
          </select>
        </div>
        
        <div class="filter-row" style="display: flex; margin-bottom: 8px; align-items: center;">
          <label style="width: 120px;">🔢 Top N Sonuç:</label>
          <input type="number" id="topn-input" value="10" min="1" max="100" style="flex-grow: 1; padding: 5px;">
        </div>
      </div>
      
      <!-- Hammadde Karışımı Bölümü -->
      <div class="material-mixer" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
        <h4 style="margin-top: 0;">🧵 Hammadde Karışımı (Opsiyonel):</h4>
        
        <div class="material-table">
          <div class="material-header" style="display: grid; grid-template-columns: 100px 1fr 60px 30px; font-weight: bold; margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px solid #eee;">
            <span class="material-name">Hammadde</span>
            <span class="material-range">Oran (%)</span>
            <span class="material-value">Değer</span>
            <span class="material-action"></span>
          </div>
          
          <div id="material-rows">
            <!-- Dinamik olarak eklenecek hammadde satırları -->
          </div>
        </div>
        
        <div class="material-total" style="display: flex; justify-content: space-between; align-items: center; margin: 10px 0;">
          <span>Toplam: <span id="total-percentage">0</span>%</span>
          <div class="progress-bar" style="width: 70%; height: 10px; background-color: #eee; border-radius: 5px; overflow: hidden;">
            <div id="total-progress" style="height: 100%; background-color: #3366cc; transition: width 0.3s; width: 0%;"></div>
          </div>
        </div>
        
        <div class="material-actions" style="display: flex; gap: 10px; margin-top: 10px;">
          <select id="material-selector" style="flex-grow: 1; padding: 5px;"></select>
          <button id="add-material" style="padding: 5px 10px;">+ Karışım Ekle</button>
        </div>
      </div>
      
      <!-- Teknik Özellikler Bölümü -->
      <div class="feature-section" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
        <h4 style="margin-top: 0;">🧬 Teknik Özellikler (Opsiyonel):</h4>
        <div class="feature-grid" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
          <label><input type="checkbox" value="MONOSTRETCH" class="feature-checkbox"> MONOSTRETCH</label>
          <label><input type="checkbox" value="COMFORT" class="feature-checkbox"> COMFORT</label>
          <label><input type="checkbox" value="BREATHABLE" class="feature-checkbox"> BREATHABLE</label>
          <label><input type="checkbox" value="WASHABLE" class="feature-checkbox"> WASHABLE</label>
          <label><input type="checkbox" value="UVPROTECTION" class="feature-checkbox"> UV PROTECTION</label>
          <label><input type="checkbox" value="THERMALCOMFORT" class="feature-checkbox"> THERMAL COMFORT</label>
        </div>
      </div>
      
      <!-- Cluster Durumu -->
      <div class="cluster-section" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px;">
        <h4 style="margin-top: 0;">🧩 Cluster Durumu:</h4>
        <div>
          <label><input type="radio" name="center-cluster" value="" checked> Tüm</label>
          <label><input type="radio" name="center-cluster" value="clustered"> Cluster'lı</label>
          <label><input type="radio" name="center-cluster" value="unclustered"> Cluster'sız</label>
        </div>
      </div>
      
      <!-- Aksiyon Butonları -->
      <div class="filter-actions" style="display: flex; justify-content: space-between; margin-top: 15px; padding-top: 15px; border-top: 1px solid #eee;">
        <button id="reset-filters" style="padding: 8px 15px;">🔁 Parametreleri Sıfırla</button>
        <button id="apply-filters" style="padding: 8px 15px; background-color: #3366cc; color: white; border: none; border-radius: 4px;">🔍 Arama Yap</button>
      </div>
    </div>

    <div id="center-results" class="image-grid">
      Benzer görseller burada gösterilecek.
    </div>
  </div>

  <div class="panel" id="right-panel">
    <h2>🧐 Sağ Panel - Cluster Temsilcileri</h2>
  </div>
  <script src="{{ url_for('static', filename='js/init.js') }}"></script>
  <script src="{{ url_for('static', filename='js/performance-fix.js') }}"></script>
  <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
  <script src="{{ url_for('static', filename='js/train_interface.js') }}"></script>
  <script src="{{ url_for('static', filename='js/center_panel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/left_panel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/right_panel.js') }}"></script>
  <script>
  // Örnek: desen modeli ve v1 versiyonu yüklensin
  window.addEventListener("DOMContentLoaded", () => {
    if (typeof loadClusterRepresentatives === "function") {
      loadClusterRepresentatives("pattern", "v1");
    }
  });
</script>
  <script>
    function addKarisimFilter() {
      if (window.addKarisimFilter) {
        window.addKarisimFilter();
      } else {
        console.warn("⛔ window.addKarisimFilter tanımlı değil.");
      }
    }
  </script>
  <script src="https://cdn.jsdelivr.net/npm/nouislider@14.6.3/distribute/nouislider.min.js"></script>
  <script>
    // Hammadde dropdown'unu dinamik doldur
    window.addEventListener("DOMContentLoaded", () => {
      const selector = document.getElementById("material-selector");
      if (!selector || !window.blendSet) return;

      const defaultOption = document.createElement("option");
      defaultOption.value = "";
      defaultOption.textContent = "Hammadde Seçin";
      selector.appendChild(defaultOption);

      window.blendSet.forEach(htype => {
        const opt = document.createElement("option");
        opt.value = htype;
        opt.textContent = htype;
        selector.appendChild(opt);
      });
    });
  </script>
  <div id="training-modal" style="display: none; position: fixed; z-index: 1000; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); overflow: auto;">
  <div class="modal-content" style="background-color: #fff; margin: 5% auto; padding: 20px; border-radius: 8px; width: 80%; max-width: 800px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
    <span class="close-modal" style="float: right; font-size: 28px; font-weight: bold; cursor: pointer;">&times;</span>
    <div id="modal-body">
      <!-- Burada dinamik içerik gösterilecek -->
    </div>
  </div>
</div>

<!-- Modal kapatma için event listener'lar -->
<script>
  // Modal kapama düğmesine tıklama olayı ekle
  document.querySelector('.close-modal').addEventListener('click', function() {
    document.getElementById('training-modal').style.display = 'none';
  });
  
  // Modalın dışına tıklandığında kapatma
  window.addEventListener('click', function(event) {
    if (event.target == document.getElementById('training-modal')) {
      document.getElementById('training-modal').style.display = 'none';
    }
  });
</script>
  
  <!-- Debug Panel -->
  <div id="debug-panel" style="position: fixed; bottom: 10px; left: 10px; z-index: 9999; background-color: #f9f9f9; border: 1px solid #ddd; padding: 10px; border-radius: 4px; max-width: 600px; max-height: 300px; overflow: auto;">
    <h3 style="margin-top: 0;">Debug Panel</h3>
    <pre id="debug-log" style="margin: 0; max-height: 250px; overflow: auto; font-size: 12px; white-space: pre-wrap;"></pre>
    <button id="clear-debug" style="margin-top: 10px; padding: 5px 10px;">Temizle</button>
    <button id="close-debug" style="margin-top: 10px; padding: 5px 10px; float: right;">Kapat</button>
  </div>
  
  <script>
    // Debug panel fonksiyonları
    document.getElementById("clear-debug").addEventListener("click", function() {
      document.getElementById("debug-log").innerHTML = "";
    });
    
    document.getElementById("close-debug").addEventListener("click", function() {
      document.getElementById("debug-panel").style.display = "none";
    });
    
    // Console.log'u override ederek debug paneline yazdırmak için
    const oldConsoleLog = console.log;
    console.log = function() {
      const args = Array.from(arguments);
      const debugLog = document.getElementById("debug-log");
      const time = new Date().toLocaleTimeString();
      
      if (args[0]?.includes?.('DEBUG:')) {
        // Panel görünür yap
        document.getElementById("debug-panel").style.display = "block";
        
        // Panel için log mesajı oluştur
        const logEntry = document.createElement('div');
        logEntry.innerHTML = `<span style="color:#777">[${time}]</span> ${args.join(' ')}`;
        debugLog.appendChild(logEntry);
        
        // Her 100 mesajda bir temizlik yapalım, performans için
        if (debugLog.children.length > 100) {
          debugLog.removeChild(debugLog.firstChild);
        }
        
        debugLog.scrollTop = debugLog.scrollHeight;
      }
      
      oldConsoleLog.apply(console, arguments);
    };
  </script>
</body>
</html>
